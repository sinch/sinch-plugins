description = "Create a new webhook for the Sinch Conversation API app"

prompt = """
Create a new webhook to receive real-time events from the Sinch Conversation API.

Arguments: {{args}}

Instructions:
1. Parse and validate arguments:
   - --target or -t: Webhook target URL (HTTPS required) - REQUIRED
   - --triggers or -tr: Comma-separated list of triggers - REQUIRED
   - --secret or -s: Secret for webhook signature verification (optional, min 16 chars)
   
   Example: --target=https://example.com/webhook --triggers=MESSAGE_INBOUND,MESSAGE_DELIVERY --secret=my-secret-key-123456

2. Validate inputs:
   - Target must be a valid HTTPS URL (starts with https://)
   - Triggers must be non-empty
   - Parse triggers by splitting on commas and trimming whitespace
   - Normalize triggers to uppercase (e.g., message_inbound → MESSAGE_INBOUND)
   - Validate triggers are from the allowed list (see Available Triggers below)
   - If secret provided, ensure it's at least 16 characters

3. Retrieve Sinch configuration from environment variables:
   - CONVERSATION_PROJECT_ID
   - CONVERSATION_REGION
   - CONVERSATION_APP_ID
   - CONVERSATION_KEY_ID
   - CONVERSATION_KEY_SECRET

4. Check for duplicate webhooks:
   - First list existing webhooks
   - If target URL already exists, report error with the webhook ID

5. Create the webhook:
   - Endpoint: POST https://{region}.conversation.api.sinch.com/v1/projects/{projectId}/webhooks
   - Use OAuth2 authentication
   - Request body:
     {
       "target": "<target_url>",
       "target_type": "HTTP",
       "triggers": ["<TRIGGER1>", "<TRIGGER2>"],
       "secret": "<optional_secret>",
       "app_id": "<appId>"
     }

6. Report results:
   - Success: "✅ Webhook created successfully! ID: {webhook_id}"
   - Display webhook details (ID, target, triggers)

Available Triggers:
- MESSAGE_DELIVERY - Delivery receipts for sent messages
- MESSAGE_INBOUND - Inbound messages from end users
- MESSAGE_SUBMIT - Message submission events
- MESSAGE_INBOUND_SMART_CONVERSATION_REDACTION - Smart conversation redaction
- EVENT_DELIVERY - Event delivery receipts
- EVENT_INBOUND - Inbound events
- CONVERSATION_START - New conversation started
- CONVERSATION_STOP - Conversation stopped
- CONVERSATION_DELETE - Conversation deleted
- CONTACT_CREATE - Contact created
- CONTACT_DELETE - Contact deleted
- CONTACT_MERGE - Contacts merged
- CONTACT_UPDATE - Contact updated
- OPT_IN - User opted in
- OPT_OUT - User opted out
- CAPABILITY - Channel capability changes
- CHANNEL_EVENT - Channel-specific events

Example usage:
/sinch:webhooks:create --target=https://example.com/webhook --triggers=MESSAGE_INBOUND
/sinch:webhooks:create -t https://example.com/webhook -tr MESSAGE_INBOUND,MESSAGE_DELIVERY --secret=my-secret-key-123456

API Reference:
https://developers.sinch.com/docs/conversation/api-reference/conversation/tag/Webhooks/#tag/Webhooks/operation/Webhooks_CreateWebhook
"""
