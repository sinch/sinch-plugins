description = "Get message status and delivery events via Sinch Conversation API"

prompt = """
# Get Message Status

Retrieve message status and delivery events for a sent message. This shows you the delivery lifecycle including events like SENT, DELIVERED, READ, or FAILED.

**IMPORTANT: Execute this command directly. Do NOT generate script files. Do NOT create Python/JavaScript files. Perform the API call immediately using the instructions below.**

## Input

- `--message_id` / `-m`: Message ID to retrieve events for (required)

Arguments: {{args}}

## Instructions

**Execute these steps directly - do not write code or scripts:**

0. Check if {{args}} is empty or only contains the command name:
   - If empty or no meaningful arguments provided, enter interactive mode:
     * Ask: "üîç What is the message ID you want to check?"
     * Use the provided answer as the message_id for the following steps
   - If arguments are provided, proceed directly to step 1

1. Parse and validate arguments from {{args}} or interactive input:
   - Validate that `--message_id` is provided and non-empty

2. Try to call the MCP tool `mcp__sinch__get-message-events` with the message ID.

3. If MCP tool is available:
   - Display the events in a table format if possible
   - Skip to step 6

4. If MCP tool is NOT available, fallback to direct API implementation:
   - Check required environment variables:
     * CONVERSATION_PROJECT_ID
     * CONVERSATION_REGION
     * CONVERSATION_KEY_ID
     * CONVERSATION_KEY_SECRET
   - If any are missing, report: "Sinch API is not configured. Please set the required environment variables."

5. Retrieve message events using the Sinch Conversation API:
   - Note: This requires webhooks to be configured to receive delivery events
   - Alternative approach: Query message details
   - Endpoint: `GET https://{region}.conversation.api.sinch.com/v1/projects/{projectId}/messages/{messageId}`
   - Use OAuth2 authentication with key ID and secret
   - Include authorization header with the access token
   - Display available message information (status, timestamps, etc.)
   - Note to user: "For full event history, ensure webhooks are configured. Events shown are from webhook cache."

6. Display the events in a table format if possible, showing:
   - Event Type (e.g., DELIVERED, READ, FAILED, SENT, QUEUED, DISPATCHED)
   - Timestamp
   - Status Details
   - Channel
   
   If table format is not suitable, fallback to a list format with clear labels for each event.

7. Handle errors gracefully:
   - If message ID not found: "Message with ID '{message_id}' not found"
   - If API call fails, display error with status code and description
   - If no events available: "No events found for this message yet. Events may take a few moments to appear."

## Examples

Get status for a message:
```
/sinch:api:messages:status --message_id=01E9DQJFPWGZ4N9XQ3FZ8Z8Z8Z
```

Using short flag:
```
/sinch:api:messages:status -m 01E9DQJFPWGZ4N9XQ3FZ8Z8Z8Z
```

## API Reference

- **MCP Tool**: `mcp__sinch__get-message-events`
- **Documentation**: https://developers.sinch.com/docs/conversation/api-reference/conversation/tag/Events/

## Message Statuses

Common message event types you may see:
- **QUEUED**: Message is queued for sending
- **DISPATCHED**: Message has been sent to the carrier
- **DELIVERED**: Message was successfully delivered to the recipient
- **READ**: Recipient has read the message (RCS only)
- **FAILED**: Message delivery failed

## Notes

- Message events are collected via webhooks configured in your Sinch app
- Not all channels support all event types (e.g., READ receipts are RCS-only)
- Events may take a few moments to appear after sending
- This command uses the MCP tool `mcp__sinch__get-message-events` which retrieves events from the webhook cache
"""
